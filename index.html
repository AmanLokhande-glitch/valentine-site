<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Valentine?</title>

  <style>
    :root {
      --bg1: #ffdde1;
      --bg2: #ee9ca7;
      --card: rgba(255,255,255,.78);
      --text: #3b1b2a;
      --yes: #ff3b7a;
      --yes2:#ff5c93;
      --no:#444;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      background: radial-gradient(circle at 20% 20%, var(--bg1), var(--bg2));
      display: grid;
      place-items: center;
      overflow: hidden;
      padding:
        calc(12px + env(safe-area-inset-top))
        calc(12px + env(safe-area-inset-right))
        calc(12px + env(safe-area-inset-bottom))
        calc(12px + env(safe-area-inset-left));
      overscroll-behavior: none;
      -webkit-user-select: none;
      user-select: none;
    }

    /* subtle floating dots */
    .hearts {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: .32;
      background-image:
        radial-gradient(circle at 10% 20%, #fff 0 1px, transparent 2px),
        radial-gradient(circle at 70% 80%, #fff 0 1px, transparent 2px),
        radial-gradient(circle at 40% 60%, #fff 0 1px, transparent 2px),
        radial-gradient(circle at 80% 30%, #fff 0 1px, transparent 2px);
      background-size: 220px 220px;
      animation: drift 14s linear infinite;
    }
    @keyframes drift {
      from { transform: translateY(0); }
      to { transform: translateY(40px); }
    }

    .card {
      width: min(760px, 92vw);
      padding: clamp(18px, 4vw, 36px);
      border-radius: 24px;
      background: var(--card);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 20px 60px rgba(0,0,0,.18);
      position: relative;
    }

    .badge {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      font-weight: 600;
      font-size: 14px;
    }

    h1 {
      margin: 14px 0 10px;
      font-size: clamp(28px, 4.8vw, 46px);
      line-height: 1.08;
      letter-spacing: -0.02em;
    }

    p {
      margin: 0 0 18px;
      font-size: clamp(16px, 2.4vw, 20px);
      opacity: .92;
    }

    .name {
      display: inline-block;
      padding: 0 10px;
      border-radius: 12px;
      background: rgba(255,59,122,.14);
    }

    /* IMPORTANT: no position:relative, so NO button isn't trapped */
    .row {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 18px;
      min-height: 64px;
    }

    button {
      border: 0;
      cursor: pointer;
      font-weight: 800;
      padding: 14px 18px;
      border-radius: 16px;
      font-size: 18px;
      transition: transform .08s ease, filter .2s ease;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    button:active { transform: scale(.98); }

    .yes {
      background: linear-gradient(135deg, var(--yes), var(--yes2));
      color: #fff;
      box-shadow: 0 14px 30px rgba(255,59,122,.35);
    }
    .yes:hover { filter: brightness(1.05); }

    .no {
      background: rgba(0,0,0,.08);
      color: var(--no);
      touch-action: none; /* we will intercept touch/pointer */
    }

    .tiny {
      margin-top: 14px;
      font-size: 13px;
      opacity: .75;
    }

    .screen { display: none; }
    .screen.active { display: block; }

    .plan {
      margin-top: 14px;
      padding: 16px;
      border-radius: 18px;
      background: rgba(255,255,255,.65);
    }
    .plan ul { margin: 10px 0 0 18px; padding: 0; }
    .plan li { margin: 6px 0; }

    .footer {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .linkbtn {
      background: rgba(255,255,255,.7);
      font-weight: 700;
    }

    /* Password box */
    .gate {
      margin-top: 14px;
      padding: 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.65);
      display: grid;
      gap: 10px;
    }
    .gate label {
      font-weight: 700;
      font-size: 14px;
      opacity: .9;
    }
    .gateRow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    input[type="password"]{
      flex: 1 1 220px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.08);
      font-size: 16px;
      outline: none;
    }
    .hint {
      font-size: 13px;
      opacity: .75;
    }
    .error {
      font-size: 13px;
      color: #7a1d3a;
      font-weight: 700;
      display: none;
    }
    .error.show { display: block; }
  </style>
</head>

<body>
  <div class="hearts"></div>

  <main class="card" aria-live="polite">
    <!-- SCREEN 1 -->
    <section id="screen-ask" class="screen active">
      <div class="badge">üíå A tiny question for <span class="name" id="herName">you</span></div>
      <h1>Will you be my Valentine? üíò</h1>
      <p>
        I was going to write something super poetic‚Ä¶ but honestly:
        <br />
        I just want <b>you</b>. Today, and all the little days after.
      </p>

      <!-- Password Gate -->
      <div class="gate" id="gateBox">
        <label for="codeInput">Before you click anything‚Ä¶ enter the love code üîí</label>
        <div class="gateRow">
          <input id="codeInput" type="password" placeholder="(our inside joke üòå)" autocomplete="off" />
          <button class="linkbtn" id="unlockBtn">Unlock</button>
        </div>
        <div class="hint" id="hintText">Hint: it‚Äôs something only we know.</div>
        <div class="error" id="errorText">Nope üòÖ try again</div>
      </div>

      <div class="row" id="btnRow">
        <button class="yes" id="yesBtn" disabled style="opacity:.6; filter:saturate(.7);">YES üíñ</button>
        <button class="no" id="noBtn">No üôÉ</button>
      </div>

      <div class="tiny" id="tinyText">Unlock it first üòå</div>
    </section>

    <!-- SCREEN 2: multi-step YES flow -->
    <section id="screen-yes" class="screen">
      <div class="badge" id="stepBadge">ü•∞ Step 1</div>
      <h1 id="stepTitle">Wait‚Ä¶ are you sure? üò≥</h1>
      <p id="stepText">Because I‚Äôm about to get very happy.</p>

      <div class="plan" id="stepBox">
        <b id="stepBoxTitle">Tap ‚ÄúNext‚Äù üëá</b>
        <ul id="stepList">
          <li>One tiny step for you‚Ä¶</li>
          <li>One giant step for my heart üíò</li>
        </ul>
      </div>

      <div class="footer">
        <button class="linkbtn" id="restartBtn">Replay</button>
        <button class="yes" id="nextBtn">Next ‚ûú</button>
      </div>
    </section>
  </main>

  <script>
    // ===== CUSTOMIZE HERE =====
    const SETTINGS = {
      herName: "My Love",
      loveCode: "pizza",              // <--- change this to your inside joke / code
      hint: "Hint: our favorite thing üçï",
      personalLine: "I choose you. Always. üíû"
    };

    // ===== BASIC WIRES =====
    const herNameEl = document.getElementById("herName");
    const ask = document.getElementById("screen-ask");
    const yesScreen = document.getElementById("screen-yes");

    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");

    const codeInput = document.getElementById("codeInput");
    const unlockBtn = document.getElementById("unlockBtn");
    const hintText = document.getElementById("hintText");
    const errorText = document.getElementById("errorText");
    const tinyText = document.getElementById("tinyText");

    herNameEl.textContent = SETTINGS.herName;
    hintText.textContent = SETTINGS.hint;

    // Prevent iOS "rubber band" while interacting
    document.documentElement.style.overscrollBehavior = "none";
    document.body.style.overscrollBehavior = "none";

    let unlocked = false;
    let yesScale = 1;
    let noDodges = 0;

    function setYesEnabled(enabled) {
      yesBtn.disabled = !enabled;
      yesBtn.style.opacity = enabled ? "1" : ".6";
      yesBtn.style.filter = enabled ? "none" : "saturate(.7)";
      tinyText.textContent = enabled ? "Okay‚Ä¶ now choose wisely üòå" : "Unlock it first üòå";
    }

    setYesEnabled(false);

    function normalize(s) {
      return (s || "").trim().toLowerCase();
    }

    function unlock() {
      const entered = normalize(codeInput.value);
      if (entered && entered === normalize(SETTINGS.loveCode)) {
        unlocked = true;
        errorText.classList.remove("show");
        setYesEnabled(true);
        burstHearts(14);
        codeInput.blur();
      } else {
        errorText.classList.add("show");
        burstHearts(6);
      }
    }

    unlockBtn.addEventListener("click", unlock);
    codeInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") unlock();
    });

    // ===== YES FLOW (multi-step) =====
    const stepBadge = document.getElementById("stepBadge");
    const stepTitle = document.getElementById("stepTitle");
    const stepText  = document.getElementById("stepText");
    const stepBoxTitle = document.getElementById("stepBoxTitle");
    const stepList = document.getElementById("stepList");
    const nextBtn = document.getElementById("nextBtn");
    const restartBtn = document.getElementById("restartBtn");

    const steps = [
      {
        badge: "ü•∞ Step 1",
        title: "Wait‚Ä¶ are you sure? üò≥",
        text: "Because I‚Äôm about to get very happy.",
        boxTitle: "Tap ‚ÄúNext‚Äù üëá",
        list: ["One tiny step for you‚Ä¶", "One giant step for my heart üíò"],
        nextText: "Next ‚ûú"
      },
      {
        badge: "üíû Step 2",
        title: "Like‚Ä¶ REALLY sure? ü•∫",
        text: "Because I already picked you in every universe.",
        boxTitle: "If you say yes, you agree to:",
        list: ["Extra hugs", "A cute date", "Me being annoying (lovingly)"],
        nextText: "Yes, continue ‚ûú"
      },
      {
        badge: "üíñ Step 3",
        title: "YAYYYYY üíù",
        text: SETTINGS.personalLine,
        boxTitle: "Proposed Valentine Plan:",
        list: ["üçì Your favorite treat", "üçΩÔ∏è Dinner (my treat)", "üé¨ Cozy movie / something fun", "üì∏ One cute photo together"],
        nextText: "More hearts üíó"
      }
    ];

    let stepIndex = 0;

    function renderStep() {
      const s = steps[stepIndex];
      stepBadge.textContent = s.badge;
      stepTitle.textContent = s.title;
      stepText.textContent = s.text;
      stepBoxTitle.textContent = s.boxTitle;

      stepList.innerHTML = "";
      s.list.forEach(item => {
        const li = document.createElement("li");
        li.textContent = item;
        stepList.appendChild(li);
      });

      nextBtn.textContent = s.nextText;
    }

    function showYesScreen() {
      if (!unlocked) return;
      ask.classList.remove("active");
      yesScreen.classList.add("active");
      stepIndex = 0;
      renderStep();
      burstHearts(18);
    }

    yesBtn.addEventListener("click", showYesScreen);

    nextBtn.addEventListener("click", () => {
      if (stepIndex < steps.length - 1) {
        stepIndex++;
        renderStep();
        burstHearts(12);
      } else {
        burstHearts(24);
      }
    });

    restartBtn.addEventListener("click", () => {
      yesScreen.classList.remove("active");
      ask.classList.add("active");
      stepIndex = 0;
      yesScale = 1;
      yesBtn.style.transform = "scale(1)";
      teleportNoButton();
    });

    // ===== NO BUTTON: iOS-friendly "unclickable" behavior =====
    // - Moves on pointermove/touchmove when finger gets near
    // - Cancels click/tap
    // - Uses visualViewport so it works well on iPhone Safari (address bar changes)
    noBtn.style.position = "fixed";
    noBtn.style.zIndex = "9999";
    noBtn.style.touchAction = "none";
    noBtn.setAttribute("tabindex", "-1");

    function viewportSize() {
      const vv = window.visualViewport;
      return vv
        ? { w: vv.width, h: vv.height, ox: vv.offsetLeft, oy: vv.offsetTop }
        : { w: window.innerWidth, h: window.innerHeight, ox: 0, oy: 0 };
    }

    function teleportNoButton() {
      const padding = 16;
      const rect = noBtn.getBoundingClientRect();
      const { w, h, ox, oy } = viewportSize();

      const maxX = Math.max(padding, w - rect.width - padding);
      const maxY = Math.max(padding, h - rect.height - padding);

      const x = ox + padding + Math.random() * (maxX - padding);
      const y = oy + padding + Math.random() * (maxY - padding);

      noBtn.style.left = `${x}px`;
      noBtn.style.top  = `${y}px`;

      avoidYesOverlap();
    }

    function avoidYesOverlap() {
      const n = noBtn.getBoundingClientRect();
      const y = yesBtn.getBoundingClientRect();
      const overlap = !(n.right < y.left || n.left > y.right || n.bottom < y.top || n.top > y.bottom);
      if (overlap) {
        // try again quickly
        const tries = 3;
        for (let i = 0; i < tries; i++) {
          const padding = 16;
          const rect = noBtn.getBoundingClientRect();
          const { w, h, ox, oy } = viewportSize();
          const maxX = Math.max(padding, w - rect.width - padding);
          const maxY = Math.max(padding, h - rect.height - padding);
          noBtn.style.left = `${ox + padding + Math.random() * (maxX - padding)}px`;
          noBtn.style.top  = `${oy + padding + Math.random() * (maxY - padding)}px`;
          const n2 = noBtn.getBoundingClientRect();
          const overlap2 = !(n2.right < y.left || n2.left > y.right || n2.bottom < y.top || n2.top > y.bottom);
          if (!overlap2) break;
        }
      }
    }

    function growYesLittle() {
      if (!unlocked) return;
      yesScale = Math.min(1.65, yesScale + 0.06);
      yesBtn.style.transform = `scale(${yesScale})`;
      const lines = [
        "Okay‚Ä¶ now choose wisely üòå",
        "Be honest üòá",
        "That YES button looks nice üëÄ",
        "We both know the answer üíñ",
        "Stop playinggg üò≠üíò"
      ];
      tinyText.textContent = lines[Math.min(lines.length - 1, Math.floor(noDodges / 2))];
    }

    // Start position
    window.addEventListener("load", teleportNoButton);
    window.addEventListener("resize", teleportNoButton);
    window.visualViewport?.addEventListener("resize", teleportNoButton);
    window.visualViewport?.addEventListener("scroll", teleportNoButton);

    // Throttle so it feels smooth
    let lastMove = 0;
    function maybeRunAway(clientX, clientY) {
      const now = performance.now();
      if (now - lastMove < 45) return;
      lastMove = now;

      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width / 2;
      const cy = r.top + r.height / 2;
      const dist = Math.hypot(clientX - cx, clientY - cy);

      // Slightly larger danger zone on phones
      const dangerRadius = 170;

      if (dist < dangerRadius) {
        noDodges++;
        teleportNoButton();
        growYesLittle();
      }
    }

    // Desktop / modern mobile browsers
    document.addEventListener("pointermove", (e) => {
      maybeRunAway(e.clientX, e.clientY);
    }, { passive: true });

    // iOS fallback: move when finger moves
    document.addEventListener("touchmove", (e) => {
      const t = e.touches && e.touches[0];
      if (!t) return;
      maybeRunAway(t.clientX, t.clientY);
    }, { passive: true });

    // If they actually touch/click it: cancel + teleport immediately
    noBtn.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      e.stopPropagation();
      noDodges++;
      teleportNoButton();
      growYesLittle();
    });

    noBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      e.stopPropagation();
      noDodges++;
      teleportNoButton();
      growYesLittle();
    }, { passive: false });

    noBtn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      noDodges++;
      teleportNoButton();
      growYesLittle();
    });

    // ===== Hearts effect =====
    function burstHearts(count) {
      for (let i = 0; i < count; i++) {
        const heart = document.createElement("div");
        heart.textContent = ["üíñ","üíò","üíó","üíù","üíï"][Math.floor(Math.random()*5)];
        heart.style.position = "fixed";
        heart.style.left = Math.random() * 100 + "vw";
        heart.style.top = "105vh";
        heart.style.fontSize = (18 + Math.random()*22) + "px";
        heart.style.opacity = 0.95;
        heart.style.filter = "drop-shadow(0 10px 10px rgba(0,0,0,.15))";
        heart.style.transition = "transform 2.2s ease, opacity 2.2s ease";
        heart.style.pointerEvents = "none";
        document.body.appendChild(heart);

        requestAnimationFrame(() => {
          const rise = 70 + Math.random() * 40;
          const drift = (Math.random() * 2 - 1) * 20;
          heart.style.transform = `translate(${drift}vw, -${rise}vh) rotate(${(Math.random()*60-30)}deg)`;
          heart.style.opacity = 0;
        });

        setTimeout(() => heart.remove(), 2300);
      }
    }
  </script>
</body>
</html>
