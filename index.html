<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Will you be my Valentine?</title>

  <style>
    :root{
      --bg1:#ffdde1; --bg2:#ee9ca7;
      --card:rgba(255,255,255,.78);
      --text:#3b1b2a;
      --yes:#ff3b7a; --yes2:#ff5c93;
      --no:#444;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0}
    body{
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:radial-gradient(circle at 20% 20%, var(--bg1), var(--bg2));
      display:grid; place-items:center;
      overflow:hidden;
      padding:
        calc(12px + env(safe-area-inset-top))
        calc(12px + env(safe-area-inset-right))
        calc(12px + env(safe-area-inset-bottom))
        calc(12px + env(safe-area-inset-left));
      overscroll-behavior:none;
      -webkit-user-select:none; user-select:none;
    }

    .hearts{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.32;
      background-image:
        radial-gradient(circle at 10% 20%, #fff 0 1px, transparent 2px),
        radial-gradient(circle at 70% 80%, #fff 0 1px, transparent 2px),
        radial-gradient(circle at 40% 60%, #fff 0 1px, transparent 2px),
        radial-gradient(circle at 80% 30%, #fff 0 1px, transparent 2px);
      background-size:220px 220px;
      animation:drift 14s linear infinite;
    }
    @keyframes drift{from{transform:translateY(0)} to{transform:translateY(40px)}}

    /* IMPORTANT: card scrolls if content is long */
    .card{
      width:min(780px, 92vw);
      max-height: calc(100dvh - 24px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
      overflow:auto;
      -webkit-overflow-scrolling: touch;

      padding:clamp(18px, 4vw, 36px);
      border-radius:24px;
      background:var(--card);
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
      box-shadow:0 20px 60px rgba(0,0,0,.18);
      position:relative;
    }

    .badge{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.65);
      font-weight:600; font-size:14px;
    }
    h1{
      margin:14px 0 10px;
      font-size:clamp(28px, 4.8vw, 46px);
      line-height:1.08;
      letter-spacing:-0.02em;
    }
    p{
      margin:0 0 18px;
      font-size:clamp(16px, 2.4vw, 20px);
      opacity:.92;
    }
    .name{
      display:inline-block;
      padding:0 10px;
      border-radius:12px;
      background:rgba(255,59,122,.14);
    }

    /* IMPORTANT: no position:relative so NO is not trapped */
    .row{
      display:flex; gap:14px; flex-wrap:wrap; align-items:center;
      margin-top:18px; min-height:64px;
    }

    button{
      border:0; cursor:pointer;
      font-weight:800;
      padding:14px 18px;
      border-radius:16px;
      font-size:18px;
      transition:transform .12s ease, filter .2s ease, opacity .2s ease;
      -webkit-tap-highlight-color:transparent;
      touch-action:manipulation;
      user-select:none;
    }
    button:active{transform:scale(.98)}

    .yes{
      background:linear-gradient(135deg, var(--yes), var(--yes2));
      color:#fff;
      box-shadow:0 14px 30px rgba(255,59,122,.35);
      transform-origin:center;
      display:inline-block;
      will-change:transform;
    }
    .yes:hover{filter:brightness(1.05)}

    .no{
      background:rgba(0,0,0,.08);
      color:var(--no);
      touch-action:none;
      will-change:left, top;
    }

    .tiny{margin-top:14px; font-size:13px; opacity:.78}

    .screen{display:none}
    .screen.active{display:block}

    .gate{
      margin-top:14px;
      padding:14px;
      border-radius:18px;
      background:rgba(255,255,255,.65);
      display:grid;
      gap:10px;
    }
    .gate label{font-weight:700; font-size:14px; opacity:.9}
    .gateRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    input[type="password"]{
      flex:1 1 220px;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.08);
      font-size:16px;
      outline:none;
    }

    .hintRow{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .michaelPic{
      width:72px;
      height:72px;
      border-radius:14px;
      object-fit:cover;
      box-shadow:0 10px 22px rgba(0,0,0,.16);
      flex:0 0 auto;
    }

    .hint{font-size:13px; opacity:.75}
    .error{font-size:13px; color:#7a1d3a; font-weight:800; display:none}
    .error.show{display:block}

    .plan{
      margin-top:14px;
      padding:16px;
      border-radius:18px;
      background:rgba(255,255,255,.65);
    }
    .plan ul{margin:10px 0 0 18px; padding:0}
    .plan li{margin:6px 0}

    .footer{
      margin-top:18px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .linkbtn{
      background:rgba(255,255,255,.7);
      font-weight:800;
    }

    .song{
      margin-top:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .song a{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:12px 14px;
      border-radius:14px;
      background:rgba(255,255,255,.72);
      text-decoration:none;
      color:var(--text);
      font-weight:900;
    }

    /* Keep paragraph breaks in the final message */
    #stepText{white-space:pre-wrap}
  </style>
</head>

<body>
  <div class="hearts"></div>

  <main class="card" aria-live="polite">
    <!-- SCREEN 1 -->
    <section id="screen-ask" class="screen active">
      <div class="badge">üíå A tiny question for <span class="name" id="herName">you</span></div>
      <h1>Will you be my Valentine? üíò</h1>
      <p>
        I was going to write something super poetic‚Ä¶ but honestly:
        <br />
        I just want <b>you</b>. Today, and all the little days after.
      </p>

      <!-- Password Gate -->
      <div class="gate" id="gateBox">
        <label for="codeInput">Before you click anything‚Ä¶ enter the love code üîí</label>
        <div class="gateRow">
          <input id="codeInput" type="password" placeholder="(Michael Scott fans only üòå)" autocomplete="off" />
          <button class="linkbtn" id="unlockBtn">Unlock</button>
        </div>

        <div class="hintRow">
          <img class="michaelPic" src="./michael.jpg" alt="Michael Scott shouting" />
          <div class="hint" id="hintText"></div>
        </div>

        <div class="error" id="errorText">Nope üòÖ try again</div>
      </div>

      <div class="row" id="btnRow">
        <button class="yes" id="yesBtn" disabled style="opacity:.65; filter:saturate(.7);">YES üíñ</button>
        <button class="no" id="noBtn">No üôÉ</button>
      </div>

      <div class="tiny" id="tinyText">Unlock it first üòå</div>
    </section>

    <!-- SCREEN 2 -->
    <section id="screen-yes" class="screen">
      <div class="badge" id="stepBadge">ü•∞ Step 1</div>
      <h1 id="stepTitle">Wait‚Ä¶ are you sure? üò≥</h1>
      <p id="stepText">Because I‚Äôm about to get very happy.</p>

      <div class="plan" id="planBox">
        <b id="stepBoxTitle">Tap ‚ÄúNext‚Äù üëá</b>
        <ul id="stepList"></ul>
      </div>

      <div class="song">
        <a id="songLink" href="#" target="_blank" rel="noopener">üé∂ Play our song</a>
      </div>

      <div class="footer">
        <button class="linkbtn" id="restartBtn">Replay</button>
        <button class="yes" id="nextBtn">Next ‚ûú</button>
      </div>
    </section>
  </main>

  <script>
    // ===== CUSTOMIZE HERE =====
    const SETTINGS = {
      herName: "My Love",
      loveCode: "i declare bankruptcy",
      hint: "Hint: Michael shouted it at the office üì£",

      // Shows ONLY on the final step (Step 4)
      personalLine: `Thank you for staying with me. Thank you for being patient with me, for understanding me, and for handling all of my dramas - even the ones that don‚Äôt always make sense. I know I can be a lot sometimes. But you still choose to be here, and you try to understand me instead of judging me. That means more to me than you know. You‚Äôve made me feel safe, loved, and accepted in a way I didn‚Äôt realize I needed.

And you genuinely don‚Äôt know how much you mean to me. I don‚Äôt think I‚Äôve ever been able to fully explain how much I love you, how grateful I am for you, and how much I want you with me - not just right now, but forever.

Sometimes I look back at everything that happened in my life, and one thing I‚Äôm truly glad about is coming to India. Even if at the time it felt like a random or risky decision, I‚Äôm grateful I took it - because that decision is what brought me to you. It gave me a chance to meet you, to know you, and to fall for you. And honestly‚Ä¶ to try to win your heart.

You became the best part of that whole chapter. I don‚Äôt take you for granted - not your love, not your patience, not your presence. I just want to keep choosing you, growing with you, and building something real with you. I choose you. Always.`,

      songTitle: "You Make My Dreams (Come True) ‚Äî Hall & Oates",
      songUrl: "https://www.youtube.com/results?search_query=You+Make+My+Dreams+Hall+and+Oates"
    };

    // ===== WIRES =====
    const herNameEl = document.getElementById("herName");
    const ask = document.getElementById("screen-ask");
    const yesScreen = document.getElementById("screen-yes");

    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");

    const codeInput = document.getElementById("codeInput");
    const unlockBtn = document.getElementById("unlockBtn");
    const hintText = document.getElementById("hintText");
    const errorText = document.getElementById("errorText");
    const tinyText = document.getElementById("tinyText");

    const songLink = document.getElementById("songLink");

    const stepBadge = document.getElementById("stepBadge");
    const stepTitle = document.getElementById("stepTitle");
    const stepText  = document.getElementById("stepText");
    const planBox = document.getElementById("planBox");
    const stepBoxTitle = document.getElementById("stepBoxTitle");
    const stepList = document.getElementById("stepList");
    const nextBtn = document.getElementById("nextBtn");
    const restartBtn = document.getElementById("restartBtn");

    herNameEl.textContent = SETTINGS.herName;
    hintText.textContent = SETTINGS.hint;
    songLink.href = SETTINGS.songUrl;
    songLink.textContent = "üé∂ " + SETTINGS.songTitle;

    document.documentElement.style.overscrollBehavior = "none";
    document.body.style.overscrollBehavior = "none";

    let unlocked = false;
    let yesScale = 1;
    let noDodges = 0;

    function setYesEnabled(enabled) {
      yesBtn.disabled = !enabled;
      yesBtn.style.opacity = enabled ? "1" : ".65";
      yesBtn.style.filter = enabled ? "none" : "saturate(.7)";
      tinyText.textContent = enabled ? "Okay‚Ä¶ now choose wisely üòå" : "Unlock it first üòå";
    }
    setYesEnabled(false);

    function normalize(s){
      return (s || "").trim().toLowerCase()
        .replace(/[!?.,"'‚Äô‚Äú‚Äù]/g, "")
        .replace(/\s+/g, " ");
    }

    function unlock(){
      const entered = normalize(codeInput.value);
      if (entered && entered === normalize(SETTINGS.loveCode)) {
        unlocked = true;
        errorText.classList.remove("show");
        setYesEnabled(true);
        burstHearts(14);
        codeInput.blur();
      } else {
        errorText.classList.add("show");
        burstHearts(6);
      }
    }
    unlockBtn.addEventListener("click", unlock);
    codeInput.addEventListener("keydown", (e) => { if (e.key === "Enter") unlock(); });

    function growYesLittle(){
      yesScale = Math.min(1.95, yesScale + 0.10);
      yesBtn.style.transform = `scale(${yesScale})`;

      const lines = [
        "Unlock it first üòå",
        "That YES button is looking good üëÄ",
        "Be honest üòá",
        "We both know the answer üíñ",
        "Stop playinggg üò≠üíò"
      ];
      tinyText.textContent = lines[Math.min(lines.length - 1, Math.floor(noDodges / 2))];
    }

    // ===== YES FLOW: now 4 steps (plan is step 3, message is step 4) =====
    const steps = [
      {
        badge: "ü•∞ Step 1",
        title: "Wait‚Ä¶ are you sure? üò≥",
        text: "Because I‚Äôm about to get very happy.",
        boxTitle: "Tap ‚ÄúNext‚Äù üëá",
        list: ["One tiny step for you‚Ä¶", "One giant step for my heart üíò"],
        nextText: "Next ‚ûú"
      },
      {
        badge: "üíû Step 2",
        title: "Like‚Ä¶ REALLY sure? ü•∫",
        text: "Because I already picked you in every universe.",
        boxTitle: "If you say yes, you agree to:",
        list: ["Extra hugs", "A cute date", "Me being annoying (lovingly)"],
        nextText: "Yes, continue ‚ûú"
      },
      {
        badge: "üé¨ Step 3",
        title: "Our plan üíò",
        text: "Okay‚Ä¶ here‚Äôs the plan first üòå",
        boxTitle: "Our Valentine Plan:",
        list: ["üé¨ Cozy movie night", "üçì Your favorite treat", "üçΩÔ∏è Dinner (my treat)", "üì∏ One cute photo together"],
        nextText: "One last thing ‚ûú"
      },
      {
        badge: "üíå Step 4",
        title: "For you‚Ä¶",
        text: SETTINGS.personalLine,
        boxTitle: "",
        list: [],
        nextText: "More hearts üíó"
      }
    ];
    let stepIndex = 0;

    function renderStep(){
      const s = steps[stepIndex];
      stepBadge.textContent = s.badge;
      stepTitle.textContent = s.title;
      stepText.textContent  = s.text;
      nextBtn.textContent = s.nextText;

      // Plan box visibility
      if (s.list && s.list.length) {
        planBox.style.display = "block";
        stepBoxTitle.textContent = s.boxTitle || "";
        stepList.innerHTML = "";
        s.list.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          stepList.appendChild(li);
        });
      } else {
        planBox.style.display = "none";
        stepList.innerHTML = "";
      }
    }

    function showYesScreen(){
      if (!unlocked) {
        errorText.classList.add("show");
        burstHearts(6);
        return;
      }
      ask.classList.remove("active");
      yesScreen.classList.add("active");
      stepIndex = 0;
      renderStep();
      burstHearts(18);
    }
    yesBtn.addEventListener("click", showYesScreen);

    nextBtn.addEventListener("click", () => {
      if (stepIndex < steps.length - 1) {
        stepIndex++;
        renderStep();
        burstHearts(12);
      } else {
        burstHearts(24);
      }
    });

    restartBtn.addEventListener("click", () => {
      yesScreen.classList.remove("active");
      ask.classList.add("active");
      stepIndex = 0;
      yesScale = 1;
      yesBtn.style.transform = "scale(1)";
      teleportNoButton();
    });

    // ===== NO BUTTON: iOS-safe teleport =====
    noBtn.style.position = "fixed";
    noBtn.style.zIndex = "9999";
    noBtn.style.touchAction = "none";
    noBtn.setAttribute("tabindex", "-1");

    function getSafePadding(){
      const cs = getComputedStyle(document.body);
      return {
        left: parseFloat(cs.paddingLeft) || 16,
        right: parseFloat(cs.paddingRight) || 16,
        top: parseFloat(cs.paddingTop) || 16,
        bottom: parseFloat(cs.paddingBottom) || 16
      };
    }
    function viewportBox(){
      const vv = window.visualViewport;
      if (vv) return { w: vv.width, h: vv.height, ox: vv.offsetLeft, oy: vv.offsetTop };
      return { w: window.innerWidth, h: window.innerHeight, ox: 0, oy: 0 };
    }
    function clamp(n, min, max){ return Math.min(Math.max(n, min), max); }

    function teleportNoButton(){
      const pad = getSafePadding();
      const { w, h, ox, oy } = viewportBox();
      const rect = noBtn.getBoundingClientRect();

      const minX = ox + pad.left;
      const maxX = ox + w - rect.width - pad.right;
      const minY = oy + pad.top;
      const maxY = oy + h - rect.height - pad.bottom;

      const x = (maxX <= minX) ? minX : (minX + Math.random() * (maxX - minX));
      const y = (maxY <= minY) ? minY : (minY + Math.random() * (maxY - minY));

      noBtn.style.left = `${clamp(x, minX, maxX)}px`;
      noBtn.style.top  = `${clamp(y, minY, maxY)}px`;
    }

    function rafTeleport(){ requestAnimationFrame(teleportNoButton); }
    window.addEventListener("load", rafTeleport);
    window.addEventListener("resize", rafTeleport);
    window.addEventListener("orientationchange", rafTeleport);
    if (window.visualViewport) {
      visualViewport.addEventListener("resize", rafTeleport);
      visualViewport.addEventListener("scroll", rafTeleport);
    }

    let lastMove = 0;
    function maybeRunAway(clientX, clientY){
      const now = performance.now();
      if (now - lastMove < 45) return;
      lastMove = now;

      const r = noBtn.getBoundingClientRect();
      const cx = r.left + r.width / 2;
      const cy = r.top + r.height / 2;
      const dist = Math.hypot(clientX - cx, clientY - cy);

      const dangerRadius = 180;
      if (dist < dangerRadius) {
        noDodges++;
        teleportNoButton();
        growYesLittle();
      }
    }

    document.addEventListener("pointermove", (e) => {
      maybeRunAway(e.clientX, e.clientY);
    }, { passive: true });

    document.addEventListener("touchmove", (e) => {
      const t = e.touches && e.touches[0];
      if (!t) return;
      maybeRunAway(t.clientX, t.clientY);
    }, { passive: true });

    function denyAndRun(e){
      e.preventDefault();
      e.stopPropagation();
      noDodges++;
      teleportNoButton();
      growYesLittle();
    }
    noBtn.addEventListener("pointerdown", denyAndRun);
    noBtn.addEventListener("touchstart", denyAndRun, { passive: false });
    noBtn.addEventListener("click", denyAndRun);

    // ===== HEARTS =====
    function burstHearts(count){
      for (let i = 0; i < count; i++){
        const heart = document.createElement("div");
        heart.textContent = ["üíñ","üíò","üíó","üíù","üíï"][Math.floor(Math.random()*5)];
        heart.style.position = "fixed";
        heart.style.left = (Math.random()*100) + "vw";
        heart.style.top = "105vh";
        heart.style.fontSize = (18 + Math.random()*22) + "px";
        heart.style.opacity = 0.95;
        heart.style.filter = "drop-shadow(0 10px 10px rgba(0,0,0,.15))";
        heart.style.transition = "transform 2.2s ease, opacity 2.2s ease";
        heart.style.pointerEvents = "none";
        document.body.appendChild(heart);

        requestAnimationFrame(() => {
          const rise = 70 + Math.random()*40;
          const drift = (Math.random()*2 - 1) * 20;
          heart.style.transform = `translate(${drift}vw, -${rise}vh) rotate(${(Math.random()*60-30)}deg)`;
          heart.style.opacity = 0;
        });

        setTimeout(() => heart.remove(), 2300);
      }
    }
  </script>
</body>
</html>
